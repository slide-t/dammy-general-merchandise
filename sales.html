<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sales</title>
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f4f6f9;color:#222;}
header{background:#001219;color:#fff;padding:16px;text-align:center;font-weight:700;font-size:1.3rem;}
.container{max-width:1000px;margin:20px auto;padding:20px;}
.panel{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
input,button{padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc;}
button{border:none;cursor:pointer;font-weight:600;}
.btn-add{background:#0a9396;color:#fff;}
.btn-add:hover{background:#007f89;}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:0.95rem;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
th{background:#0077b6;color:#fff;}


  /* Reusable Water Transparent Modal */
#loginModal{
  position:fixed; inset:0;
  background:rgba(0,0,0,0.3);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
}
#loginModal .modal-content{
  background:#fff;padding:40px;border-radius:16px;
  width:360px;text-align:center;
  box-shadow:0 8px 24px rgba(0,0,0,0.3);
  position:relative;
}
#loginModal h3{margin-bottom:20px;color:#001219;}
#loginModal input{width:100%;padding:14px;margin:10px 0;border-radius:8px;border:1px solid #ccc;font-size:1rem;}
#loginModal button{
  width:100%; padding:12px; margin-top:15px; border:none; border-radius:50px; font-weight:700; cursor:pointer; font-size:1rem;
}
#loginModal .btn-login{background:#0a9396;color:#fff;}
#loginModal .btn-login:hover{background:#007f89;}
#loginMsg{margin-top:10px;color:red;font-weight:600;}

/* Spinner */
#spinnerOverlay{
  position:fixed; inset:0; background:rgba(0,0,0,0.5);
  display:flex; justify-content:center; align-items:center;
  z-index:10000; display:none;
}
.spinner-loop {
  width:100px; height:100px; border-radius:50%; border:6px solid transparent;
  border-top:6px solid red;
  border-right:6px solid green;
  border-bottom:6px solid blue;
  border-left:6px solid yellow;
  animation:spin 1s linear infinite;
  display:flex; justify-content:center; align-items:center;
}
.spinner-loop img{width:50px;height:50px; animation:spinReverse 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes spinReverse{0%{transform:rotate(0deg);}100%{transform:rotate(-360deg);}}

#logoutBtn{
  position:fixed; top:70px; right:20px;
  background:#ff5252; color:#fff; border:none; border-radius:25px 0 0 25px; padding:8px 15px 8px 5px;
  width:50px; height:50px; display:flex; justify-content:center; align-items:center;
  cursor:pointer; z-index:9999; transition:transform 0.3s;
}
#logoutBtn:hover{transform:scale(1.2);}
#logoutBtn .tooltip{
  visibility:hidden; position:absolute; top:-28px; background:#ff5252; color:#fff;
  padding:4px 8px; border-radius:6px; font-size:0.8rem; white-space:nowrap;
}
#logoutBtn.showTooltip .tooltip{visibility:visible; animation:zoom 0.6s ease-in-out infinite;}
@keyframes zoom{0%,100%{transform:scale(1);}50%{transform:scale(1.3);}}

</style>
</head>
<body>

<header>ðŸ’° Sales Checkout</header>
<div class="container">

<div class="panel">
  <h2>Add Item to Cart</h2>
  <div>
    <input type="text" id="barcodeInput" placeholder="Scan/Enter Barcode">
    <input type="number" id="sellQty" placeholder="Quantity" min="1">
    <button class="btn-add" id="addToCartBtn">Add to Cart</button>
  </div>
</div>

<div class="panel">
  <h2>Cart</h2>
  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Qty</th>
          <th>Price (â‚¦)</th>
          <th>Total (â‚¦)</th>
        </tr>
      </thead>
      <tbody id="cartTable"></tbody>
    </table>
  </div>
  <button class="btn-add" id="checkoutBtn">Checkout & Print Receipt</button>
</div>

</div>
<!-- Reusable Login Modal -->
<div id="loginModal">
  <div class="modal-content">
    <h3>Staff Login</h3>
    <input type="password" id="staffPassword" placeholder="Enter Password">
    <button class="btn-login" id="staffLoginBtn">Login</button>
    <p id="loginMsg"></p>
  </div>
</div>

<!-- Spinner Overlay -->
<div id="spinnerOverlay">
  <div class="spinner">
    <img src="logo.png" alt="Logo">
  </div>
</div>

<!-- Logout Button -->
<button id="logoutBtn">
  <span class="tooltip">Logout</span>
  <i class="fas fa-power-off"></i>
</button>
  


  

  
<script>
let db,cart=[];
const request=indexedDB.open("StoreDB",1);
request.onupgradeneeded=e=>{
  db=e.target.result;
  if(!db.objectStoreNames.contains("stock")) db.createObjectStore("stock",{keyPath:"barcode"});
  if(!db.objectStoreNames.contains("sales")) db.createObjectStore("sales",{autoIncrement:true});
};
request.onsuccess=e=>{db=e.target.result;};

// Add to cart
document.getElementById("addToCartBtn").addEventListener("click",()=>{
  const barcode=document.getElementById("barcodeInput").value.trim();
  const qty=parseInt(document.getElementById("sellQty").value);
  if(!barcode||!qty){alert("Enter barcode and qty");return;}
  const tx=db.transaction("stock","readonly").objectStore("stock");
  const req=tx.get(barcode);
  req.onsuccess=e=>{
    const item=e.target.result;
    if(!item){alert("Item not found");return;}
    if(item.qty<qty){alert("Not enough stock");return;}
    // update cart
    const exist=cart.find(i=>i.barcode===barcode);
    if(exist){exist.qty+=qty; exist.total=(exist.qty*exist.price);} 
    else cart.push({barcode,itemName:item.name,qty,price:item.price,total:qty*item.price,name:item.name});
    renderCart();
  };
});

// Render cart
function renderCart(){
  const tbody=document.getElementById("cartTable");
  tbody.innerHTML="";
  cart.forEach(i=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${i.name}</td><td>${i.qty}</td><td>â‚¦${i.price.toFixed(2)}</td><td>â‚¦${i.total.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
}

// Checkout
document.getElementById("checkoutBtn").addEventListener("click",()=>{
  if(cart.length===0){alert("Cart is empty"); return;}
  const txStock=db.transaction("stock","readwrite").objectStore("stock");
  const txSales=db.transaction("sales","readwrite").objectStore("sales");
  cart.forEach(i=>{
    // update stock
    const req=txStock.get(i.barcode);
    req.onsuccess=e=>{
      const item=e.target.result;
      item.qty-=i.qty;
      txStock.put(item);
    };
    // add to sales
    txSales.add({...i,date:new Date()});
  });
  txSales.oncomplete=()=>{
    // print receipt
    let receipt="ðŸ§¾ Receipt\n\n";
    let totalAll=0;
    cart.forEach(i=>{
      receipt+=`${i.name} x${i.qty} @â‚¦${i.price.toFixed(2)} = â‚¦${i.total.toFixed(2)}\n`;
      totalAll+=i.total;
    });
    receipt+=`\nTotal: â‚¦${totalAll.toFixed(2)}`;
    const w=window.open(); w.document.write("<pre>"+receipt+"</pre>"); w.print(); w.close();
    cart=[]; renderCart();
  };
});
</script>
<script>
// --- Staff password ---
const staffPassword="staff123";

// --- IndexedDB or other initialization here if needed ---

// --- Login Modal ---
const loginModal=document.getElementById("loginModal");
const staffLoginBtn=document.getElementById("staffLoginBtn");
const staffPasswordInput=document.getElementById("staffPassword");
const loginMsg=document.getElementById("loginMsg");
const spinnerOverlay=document.getElementById("spinnerOverlay");

staffLoginBtn.addEventListener("click",()=>{
  const val=staffPasswordInput.value.trim();
  if(val===staffPassword){
    loginMsg.textContent="";
    // Show spinner overlay
    spinnerOverlay.style.display="flex";
    loginModal.style.display="none";
    // Simulate loading 5 seconds
    setTimeout(()=>{
      spinnerOverlay.style.display="none";
      // Here load the page content / enable full page
      alert("âœ… Login successful! Page ready.");
    },5000);
  }else{
    loginMsg.textContent="âŒ Incorrect password";
  }
});

// --- Logout Button ---
const logoutBtn=document.getElementById("logoutBtn");
const tooltip=logoutBtn.querySelector(".tooltip");

logoutBtn.addEventListener("click",logout);

// Show tooltip and zoom effect every 10s
setInterval(()=>{
  logoutBtn.classList.add("showTooltip");
  setTimeout(()=>logoutBtn.classList.remove("showTooltip"),4000);
},10000);

// --- Auto logout ---
let inactivityTimer;
function resetTimer(){
  clearTimeout(inactivityTimer);
  inactivityTimer=setTimeout(logout,5*60*1000); // 5 min staff auto logout
}
['mousemove','keydown','scroll','touchstart'].forEach(evt=>document.addEventListener(evt,resetTimer));
resetTimer();

// --- Logout function ---
function logout(){
  alert("âš  You are logged out!");
  window.location.href="index.html"; // redirect to login modal
}
</script>
<script>
const deviceId = localStorage.getItem("deviceId") || crypto.randomUUID();
localStorage.setItem("deviceId", deviceId);

// Check if device is disabled
function checkDeviceDisabled(){
  const tx = db.transaction("devices","readonly").objectStore("devices");
  tx.get(deviceId).onsuccess = e=>{
    const dev = e.target.result;
    if(dev && dev.disabled){
      alert("âš  Your device has been disabled by admin!");
      window.location.href = "admin.html"; // redirect to login page
    }
  }
}

// Call on page load
checkDeviceDisabled();
  
</script>

  
</body>
</html>
