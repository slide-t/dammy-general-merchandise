<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Management</title>
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f4f6f9;color:#222;}
header{background:#001219;color:#fff;padding:16px;text-align:center;font-weight:700;font-size:1.3rem;}
.container{max-width:1200px;margin:20px auto;padding:10px;}
.panel{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 6px 20px rgba(0,0,0,0.08);}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:0.95rem;}
th,td{border:1px solid #ddd;padding:10px;text-align:center;}
th{background:#0077b6;color:#fff;}
input, select{padding:10px;border-radius:6px;border:1px solid #ccc;margin-bottom:10px;width:100%;}
button{padding:12px 20px;border:none;border-radius:8px;background:#0a9396;color:#fff;cursor:pointer;margin-top:5px;}
button:hover{background:#007f89;}
.alert-low{background:#fff3cd;color:#7a5d00;padding:10px 14px;border-radius:8px;margin-bottom:8px;font-weight:bold;}
.flex-between{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
@media(max-width:700px){.flex-between{flex-direction:column;align-items:flex-start;}}
</style>
</head>
<body>

<header>ðŸ“¦ Stock Management</header>
<div class="container">

  <div class="panel">
    <h2>Add Stock Item</h2>
    <input type="text" id="itemName" placeholder="Item Name">
    <input type="text" id="category" placeholder="Category">
    <input type="number" id="qty" placeholder="Quantity" min="1">
    <input type="number" id="price" placeholder="Price (â‚¦)" min="0">
    <button id="addStockBtn">Add Item</button>
    <p id="stockMsg"></p>
  </div>

  <div class="panel">
    <div class="flex-between">
      <h2>Stock Overview</h2>
      <button id="exportStockPDF">Export PDF</button>
    </div>
    <div id="lowStockAlerts"></div>
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th>Barcode</th>
            <th>Name</th>
            <th>Category</th>
            <th>Qty</th>
            <th>Price (â‚¦)</th>
          </tr>
        </thead>
        <tbody id="stockTable"></tbody>
      </table>
    </div>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// IndexedDB setup
let db;
const request=indexedDB.open("StoreDB",1);
request.onupgradeneeded=e=>{
  db=e.target.result;
  if(!db.objectStoreNames.contains("stock")) db.createObjectStore("stock",{keyPath:"barcode"});
};
request.onsuccess=e=>{db=e.target.result; renderStock();};
request.onerror=()=>alert("IndexedDB error");

// Generate random barcode
function generateBarcode(length=8){
  const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let code="";
  for(let i=0;i<length;i++) code+=chars.charAt(Math.floor(Math.random()*chars.length));
  return code;
}

// Add Stock
document.getElementById("addStockBtn").addEventListener("click",()=>{
  const name=document.getElementById("itemName").value.trim();
  const category=document.getElementById("category").value.trim();
  const qty=parseInt(document.getElementById("qty").value);
  const price=parseFloat(document.getElementById("price").value);
  if(!name || !category || isNaN(qty) || isNaN(price)){document.getElementById("stockMsg").textContent="âŒ Fill all fields correctly"; return;}
  const barcode=generateBarcode();
  const tx=db.transaction("stock","readwrite").objectStore("stock");
  tx.add({barcode,name,category,qty,price}).onsuccess=()=>{document.getElementById("stockMsg").textContent="âœ… Item added"; renderStock();}
});

// Render Stock
function renderStock(){
  const tbody=document.getElementById("stockTable");
  const alerts=document.getElementById("lowStockAlerts");
  tbody.innerHTML=""; alerts.innerHTML="";
  const tx=db.transaction("stock","readonly").objectStore("stock");
  tx.openCursor().onsuccess=e=>{
    const cursor=e.target.result;
    if(cursor){
      const i=cursor.value;
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${i.barcode}</td><td>${i.name}</td><td>${i.category}</td><td>${i.qty}</td><td>â‚¦${i.price.toFixed(2)}</td>`;
      tbody.appendChild(tr);
      if(i.qty<=5){
        const div=document.createElement("div");
        div.className="alert-low";
        div.textContent=`âš  Low stock: ${i.name} (Qty: ${i.qty})`;
        alerts.appendChild(div);
      }
      cursor.continue();
    }
  };
}

// Export PDF
document.getElementById("exportStockPDF").addEventListener("click",()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y=20;
  doc.setFontSize(14); doc.text("Stock Report",14,10);
  const table=document.getElementById("stockTable");
  for(let r=0;r<table.rows.length;r++){
    let row=table.rows[r];
    let rowData=[];
    for(let c=0;c<row.cells.length;c++) rowData.push(row.cells[c].innerText);
    doc.text(rowData.join(" | "),14,y); y+=7;
  }
  doc.save("Stock_Report.pdf");
});
</script>
</body>
</html>
