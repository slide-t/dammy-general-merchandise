<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Management</title>
<style>
  body{margin:0;font-family:Arial,sans-serif;background:#f4f6f9;}
  header{background:#001219;color:#fff;padding:15px;text-align:center;font-weight:bold;}
  .container{max-width:980px;margin:20px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.2);}
  h2{margin-bottom:10px;color:#001219;}
  label{display:block;margin:8px 0 4px;font-weight:bold;}
  input,select,button{padding:10px;margin:5px 0;border-radius:6px;border:1px solid #ccc;width:100%;}
  button{cursor:pointer;font-weight:bold;background:#0077b6;color:#fff;border:none;}
  button:hover{background:#023e8a;}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  @media(max-width:700px){.grid-2{grid-template-columns:1fr;}}
  table{width:100%;border-collapse:collapse;margin-top:15px;}
  th,td{border:1px solid #ddd;padding:8px;text-align:center;}
  th{background:#0077b6;color:#fff;}
  .muted{color:#555;font-size:0.9rem;}
</style>
</head>
<body>

<header>ðŸ“¦ Stock Management</header>

<div class="container">
  <section>
    <h2>Add / Update Item</h2>
    <form id="stockForm">
      <label>Category</label>
      <select id="category" required>
        <option value="">-- Select --</option>
        <option>Beverages</option><option>Bakery</option><option>Canned Goods</option>
        <option>Dairy</option><option>Frozen Foods</option><option>Meat & Poultry</option>
        <option>Produce</option><option>Snacks</option><option>Household</option>
        <option>Personal Care</option><option>Spices & Seasoning</option>
        <option>Grains & Cereals</option><option>Oils & Condiments</option>
      </select>

      <label>Item Name</label>
      <input type="text" id="itemName" placeholder="e.g., Coca-Cola 50cl" required>

      <label>Quantity</label>
      <input type="number" id="itemQty" min="1" value="1" required>

      <label>Price (â‚¦)</label>
      <input type="number" id="itemPrice" min="0" step="0.01" required>

      <!-- Hidden barcode field -->
      <input type="hidden" id="barcode">

      <button type="submit">ðŸ’¾ Save Item</button>
      <p id="msg" class="muted"></p>
    </form>
  </section>

  <section>
    <h2>Current Stock</h2>
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr><th>Name</th><th>Qty</th><th>Price (â‚¦)</th><th>Category</th></tr>
        </thead>
        <tbody id="stockTable"></tbody>
      </table>
    </div>
  </section>

  <section style="margin-top:20px;">
    <button onclick="window.location.href='sales.html'">ðŸ’µ Go to Sales / Checkout</button>
    <button onclick="window.location.href='admin.html'">ðŸ›  Admin Dashboard</button>
  </section>
</div>

<script>
let db;
const request = indexedDB.open("StoreDB",1);
request.onupgradeneeded = e=>{
  db=e.target.result;
  if(!db.objectStoreNames.contains("stock")){
    db.createObjectStore("stock",{keyPath:"barcode"});
  }
  if(!db.objectStoreNames.contains("sales")){
    db.createObjectStore("sales",{autoIncrement:true});
  }
};
request.onsuccess = e=>{db=e.target.result; renderStock();};
request.onerror = ()=>alert("DB error");

// Generate mixed alphanumeric barcode (8 chars)
function genBarcode(){
  const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let code="";
  for(let i=0;i<8;i++){code+=chars.charAt(Math.floor(Math.random()*chars.length));}
  return code;
}

const form=document.getElementById("stockForm");
const msg=document.getElementById("msg");

form.addEventListener("submit",e=>{
  e.preventDefault();
  const name=document.getElementById("itemName").value.trim();
  const category=document.getElementById("category").value;
  const qty=parseInt(document.getElementById("itemQty").value,10)||1;
  const price=parseFloat(document.getElementById("itemPrice").value)||0;
  const barcode=document.getElementById("barcode").value || genBarcode();

  const tx=db.transaction("stock","readwrite").objectStore("stock");
  tx.get(barcode).onsuccess=e=>{
    const existing=e.target.result;
    if(existing){
      existing.qty+=qty;
      existing.price=price;
      tx.put(existing);
      msg.textContent=`âœ… Updated: ${name}`;
    } else {
      tx.add({barcode,name,category,qty,price});
      msg.textContent=`âœ… Added: ${name} (barcode auto-assigned)`;
    }
    document.getElementById("barcode").value="";
    form.reset();
    renderStock();
  };
});

function renderStock(){
  const tbody=document.getElementById("stockTable");
  tbody.innerHTML="";
  const tx=db.transaction("stock","readonly").objectStore("stock");
  tx.openCursor().onsuccess=e=>{
    const cursor=e.target.result;
    if(cursor){
      const i=cursor.value;
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${i.name}</td><td>${i.qty}</td><td>â‚¦${i.price.toFixed(2)}</td><td>${i.category}</td>`;
      tbody.appendChild(tr);
      cursor.continue();
    }
  };
}
</script>

</body>
</html>
