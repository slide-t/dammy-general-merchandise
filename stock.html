<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Management</title>
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f4f6f9;color:#222;}
header{background:#001219;color:#fff;padding:16px;text-align:center;font-weight:700;font-size:1.3rem;}
.container{max-width:1000px;margin:20px auto;padding:20px;}
.panel{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.flex-between{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
@media(max-width:700px){.grid-2{grid-template-columns:1fr;}}
input,select{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc;}
button{padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;}
.btn-add{background:#0a9396;color:#fff;}
.btn-add:hover{background:#007f89;}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:0.95rem;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
th{background:#0077b6;color:#fff;}
.alert-low{background:#fff3cd;color:#7a5d00;padding:8px 12px;border-radius:6px;margin-bottom:6px;font-weight:bold;}

  /* Spinner inside button */
.spinner {
  display: inline-block;
  width: 18px;
  height: 18px;
  border: 3px solid rgba(255,255,255,0.3);
  border-top: 3px solid #fff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-left: 8px;
  vertical-align: middle;
}

.hidden { display: none; }

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>

<header>ðŸ“¦ Stock Management</header>
<div class="container">

<div class="panel">
  <h2>Add New Stock</h2>
  <div class="grid-2">
    <input type="text" id="itemName" placeholder="Item Name">
    <input type="text" id="itemCategory" placeholder="Category">
    <input type="number" id="itemQty" placeholder="Quantity" min="1">
    <input type="number" id="itemPrice" placeholder="Price (â‚¦)" min="1" step="0.01">
  </div>
<!--  <button class="btn-add" id="addStockBtn">Add Stock</button>-->
<div class="grid" style="grid-column: 1 / -1; position:relative;">
  <button id="addStockBtn" class="btn-primary" type="submit">
    <span id="btnText">âž• Add Item</span>
    <span id="btnSpinner" class="spinner hidden"></span>
  </button>
</div>
  
</div>

<div class="panel">
  <h2>Stock List</h2>
  <div id="lowStockAlerts"></div>
  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Qty</th>
          <th>Price (â‚¦)</th>
        </tr>
      </thead>
      <tbody id="stockTable"></tbody>
    </table>
  </div>
</div>

</div>
<script>
// --- IndexedDB setup ---
let db;
const request = indexedDB.open("StoreDB", 1);
request.onupgradeneeded = e => {
  db = e.target.result;
  if (!db.objectStoreNames.contains("stock")) db.createObjectStore("stock", { keyPath: "barcode" });
  if (!db.objectStoreNames.contains("sales")) db.createObjectStore("sales", { autoIncrement: true });
};
request.onsuccess = e => { db = e.target.result; renderStock(); };
request.onerror = () => alert("DB error");

// --- Generate 8-character barcode ---
function generateBarcode() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let b = '';
  for (let i = 0; i < 8; i++) b += chars.charAt(Math.floor(Math.random() * chars.length));
  return b;
}

// --- Elements ---
const addStockBtn = document.getElementById("addStockBtn");
const itemName = document.getElementById("itemName");
const itemCategory = document.getElementById("itemCategory");
const itemQty = document.getElementById("itemQty");
const itemPrice = document.getElementById("itemPrice");

// --- Spinner & Button Text ---
const btnText = document.createElement("span");
btnText.textContent = "âž• Add Item";
addStockBtn.innerHTML = '';
addStockBtn.appendChild(btnText);

const btnSpinner = document.createElement("span");
btnSpinner.className = "spinner hidden";
btnSpinner.style.marginLeft = "8px";
addStockBtn.appendChild(btnSpinner);

// --- Add Stock ---
addStockBtn.addEventListener("click", () => {
  const name = itemName.value.trim();
  const category = itemCategory.value.trim();
  const qty = parseInt(itemQty.value);
  const price = parseFloat(itemPrice.value);

  if (!name || !category || !qty || !price) { alert("âŒ Please fill all fields"); return; }

  // Disable button & show spinner
  addStockBtn.disabled = true;
  btnText.textContent = "Adding...";
  btnSpinner.classList.remove("hidden");

  // Ensure unique barcode
  let barcode;
  function tryAdd() {
    barcode = generateBarcode();
    const tx = db.transaction("stock", "readwrite").objectStore("stock");
    const req = tx.add({ barcode, name, category, qty, price });

    req.onsuccess = () => {
      renderStock();
      // Show confirmation modal
      showConfirmationModal(name, barcode);
    };

    req.onerror = () => {
      // If barcode exists, retry with new one
      tryAdd();
    };
  }
  tryAdd();
});

// --- Confirmation Modal ---
function showConfirmationModal(name, barcode) {
  // Create modal overlay
  const modal = document.createElement("div");
  modal.style.position = "fixed";
  modal.style.top = 0;
  modal.style.left = 0;
  modal.style.width = "100%";
  modal.style.height = "100%";
  modal.style.background = "rgba(0,0,0,0.4)";
  modal.style.display = "flex";
  modal.style.justifyContent = "center";
  modal.style.alignItems = "center";
  modal.style.zIndex = 9999;

  const content = document.createElement("div");
  content.style.background = "#fff";
  content.style.padding = "30px";
  content.style.borderRadius = "12px";
  content.style.textAlign = "center";
  content.style.minWidth = "300px";

  content.innerHTML = `<h3>âœ… Stock Added!</h3>
                       <p>Item: <b>${name}</b><br>Barcode: <b>${barcode}</b></p>
                       <button id="modalOkBtn" style="padding:10px 20px;border:none;background:#0a9396;color:#fff;border-radius:8px;cursor:pointer;margin-top:15px;">OK</button>`;

  modal.appendChild(content);
  document.body.appendChild(modal);

  document.getElementById("modalOkBtn").addEventListener("click", () => {
    document.body.removeChild(modal);
    // Reset form
    itemName.value = "";
    itemCategory.value = "";
    itemQty.value = "";
    itemPrice.value = "";
    itemName.focus();
    // Reset button
    addStockBtn.disabled = false;
    btnText.textContent = "âž• Add Item";
    btnSpinner.classList.add("hidden");
  });
}

// --- Render Stock ---
function renderStock() {
  const tbody = document.getElementById("stockTable");
  const alerts = document.getElementById("lowStockAlerts");
  tbody.innerHTML = "";
  alerts.innerHTML = "";

  const tx = db.transaction("stock", "readonly").objectStore("stock");
  tx.openCursor().onsuccess = e => {
    const cursor = e.target.result;
    if (cursor) {
      const i = cursor.value;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${i.name}</td><td>${i.category}</td><td>${i.qty}</td><td>â‚¦${i.price.toFixed(2)}</td>`;
      tbody.appendChild(tr);

      if (i.qty <= 5) {
        const div = document.createElement("div");
        div.className = "alert-low";
        div.textContent = `âš  Low stock: ${i.name} (Qty: ${i.qty})`;
        alerts.appendChild(div);
      }
      cursor.continue();
    }
  };
}
</script>




  <!--
<script>
// --- IndexedDB setup ---
let db;
const request = indexedDB.open("StoreDB", 1);
request.onupgradeneeded = e => {
  db = e.target.result;
  if (!db.objectStoreNames.contains("stock")) db.createObjectStore("stock", { keyPath: "barcode" });
  if (!db.objectStoreNames.contains("sales")) db.createObjectStore("sales", { autoIncrement: true });
};
request.onsuccess = e => { db = e.target.result; renderStock(); };
request.onerror = () => alert("DB error");

// --- Generate 8-character barcode ---
function generateBarcode() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let b = '';
  for (let i = 0; i < 8; i++) b += chars.charAt(Math.floor(Math.random() * chars.length));
  return b;
}

// --- Elements ---
const addStockBtn = document.getElementById("addStockBtn");
const itemName = document.getElementById("itemName");
const itemCategory = document.getElementById("itemCategory");
const itemQty = document.getElementById("itemQty");
const itemPrice = document.getElementById("itemPrice");

// --- Spinner & Button Text ---
const btnText = document.createElement("span");
btnText.textContent = "âž• Add Item";
addStockBtn.innerHTML = '';
addStockBtn.appendChild(btnText);

const btnSpinner = document.createElement("span");
btnSpinner.className = "spinner hidden";
addStockBtn.appendChild(btnSpinner);

// --- Add Stock ---
addStockBtn.addEventListener("click", () => {
  const name = itemName.value.trim();
  const category = itemCategory.value.trim();
  const qty = parseInt(itemQty.value);
  const price = parseFloat(itemPrice.value);

  if (!name || !category || !qty || !price) { alert("âŒ Please fill all fields"); return; }

  // Disable button & show spinner
  addStockBtn.disabled = true;
  btnText.textContent = "Adding...";
  btnSpinner.classList.remove("hidden");

  const barcode = generateBarcode();
  const tx = db.transaction("stock", "readwrite").objectStore("stock");
  tx.add({ barcode, name, category, qty, price });

  tx.oncomplete = () => {
    renderStock();

    // Show success popup modal
    setTimeout(() => {
      if (confirm(`âœ… Stock added successfully!\nItem: ${name}\nBarcode: ${barcode}`)) {
        // Reset form
        itemName.value = "";
        itemCategory.value = "";
        itemQty.value = "";
        itemPrice.value = "";
        // Enable button
        addStockBtn.disabled = false;
        btnText.textContent = "âž• Add Item";
        btnSpinner.classList.add("hidden");
        itemName.focus();
      }
    }, 300);
  };

  tx.onerror = () => {
    alert("âŒ Item already exists or DB error");
    addStockBtn.disabled = false;
    btnText.textContent = "âž• Add Item";
    btnSpinner.classList.add("hidden");
  };
});

// --- Render Stock ---
function renderStock() {
  const tbody = document.getElementById("stockTable");
  const alerts = document.getElementById("lowStockAlerts");
  tbody.innerHTML = "";
  alerts.innerHTML = "";

  const tx = db.transaction("stock", "readonly").objectStore("stock");
  tx.openCursor().onsuccess = e => {
    const cursor = e.target.result;
    if (cursor) {
      const i = cursor.value;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${i.name}</td><td>${i.category}</td><td>${i.qty}</td><td>â‚¦${i.price.toFixed(2)}</td>`;
      tbody.appendChild(tr);

      if (i.qty <= 5) {
        const div = document.createElement("div");
        div.className = "alert-low";
        div.textContent = `âš  Low stock: ${i.name} (Qty: ${i.qty})`;
        alerts.appendChild(div);
      }

      cursor.continue();
    }
  };
}
</script>


 <!-- 
<script>
let db;
const request=indexedDB.open("StoreDB",1);
request.onupgradeneeded=e=>{
  db=e.target.result;
  if(!db.objectStoreNames.contains("stock")) db.createObjectStore("stock",{keyPath:"barcode"});
  if(!db.objectStoreNames.contains("sales")) db.createObjectStore("sales",{autoIncrement:true});
};
request.onsuccess=e=>{db=e.target.result; renderStock();};
request.onerror=()=>alert("DB error");

// Generate barcode
function generateBarcode(){ 
  const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let b=''; for(let i=0;i<8;i++) b+=chars.charAt(Math.floor(Math.random()*chars.length));
  return b;
}

// Add stock
document.getElementById("addStockBtn").addEventListener("click",()=>{
  const name=document.getElementById("itemName").value.trim();
  const category=document.getElementById("itemCategory").value.trim();
  const qty=parseInt(document.getElementById("itemQty").value);
  const price=parseFloat(document.getElementById("itemPrice").value);
  if(!name||!category||!qty||!price){alert("Please fill all fields"); return;}
  const barcode=generateBarcode();
  const tx=db.transaction("stock","readwrite").objectStore("stock");
  tx.add({barcode,name,category,qty,price});
  tx.oncomplete=()=>{ renderStock(); document.getElementById("itemName").value="";document.getElementById("itemCategory").value="";document.getElementById("itemQty").value="";document.getElementById("itemPrice").value="";};
  tx.onerror=()=>alert("Item exists");
});

// Render stock
function renderStock(){
  const tbody=document.getElementById("stockTable");
  const alerts=document.getElementById("lowStockAlerts");
  tbody.innerHTML=""; alerts.innerHTML="";
  const tx=db.transaction("stock","readonly").objectStore("stock");
  tx.openCursor().onsuccess=e=>{
    const cursor=e.target.result;
    if(cursor){
      const i=cursor.value;
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${i.name}</td><td>${i.category}</td><td>${i.qty}</td><td>â‚¦${i.price.toFixed(2)}</td>`;
      tbody.appendChild(tr);
      if(i.qty<=5){
        const div=document.createElement("div");
        div.className="alert-low";
        div.textContent=`âš  Low stock: ${i.name} (Qty: ${i.qty})`;
        alerts.appendChild(div);
      }
      cursor.continue();
    }
  };
}
</script>
-->
</body>
</html>
